<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Gia pháº£ dÃ²ng há» LÃª ÄÃ¬nh</title>
<script src="https://d3js.org/d3.v7.min.js"></script>

<style>
body{
  font-family:"Times New Roman",serif;
  margin:0;
  padding:30px;
  background:url("https://tranhnhatthanh.vn/wp-content/uploads/2024/07/tranh-lang-que-viet-nam-xua-14.jpg")
    no-repeat center center fixed;
  background-size:cover;
}
.main{
  background:rgba(255,255,255,0.95);
  max-width:1200px;
  margin:auto;
  padding:30px 40px;
}
.menu{text-align:center;margin:20px 0}
.menu button{padding:6px 16px;font-weight:bold}
.section{display:none}
.section.active{display:block}

label{display:inline-block;width:180px}
input,select{width:280px;margin-bottom:6px}

.wrapper{height:70vh;overflow:auto;border:1px solid #ccc}
svg{width:4000px;height:2500px}

.node rect{fill:#fff;stroke:#333;rx:6;ry:6}
.link{fill:none;stroke:#999}

.locked{opacity:.4;pointer-events:none}
</style>
</head>

<body>
<div class="main">
<h1 style="text-align:center">GIA PHáº¢ DÃ’NG Há»Œ LÃŠ ÄÃŒNH</h1>

<div class="menu">
  <button onclick="show('home')">ğŸ  Trang chá»§</button>
  <button onclick="show('manage')">âœï¸ Quáº£n lÃ½</button>
  <button onclick="show('tree')">ğŸŒ³ Gia pháº£</button>
  <button onclick="adminLogin()">ğŸ” Admin</button>
</div>

<!-- ================= TRANG CHá»¦ ================= -->
<div id="home" class="section active">
<h2 style="text-align:center">Lá»œI GIá»šI THIá»†U</h2>

<p>Gia pháº£ lÃ  sá»£i dÃ¢y ná»‘i liá»n cÃ¡c tháº¿ há»‡, lÃ  nÆ¡i lÆ°u giá»¯ cá»™i nguá»“n, cÃ´ng Ä‘á»©c tá»• tiÃªn vÃ  truyá»n thá»‘ng cá»§a dÃ²ng há» qua bao Ä‘á»i.</p>
<p>DÃ²ng há» LÃª chÃºng ta láº¥y <b>Thá»§y tá»• lÃ  Cá»¥ LÃª ÄÃ¬nh Cai</b>, con trai cá»§a <b>HoÃ ng thÃ¢n LÃª Duy Máº­t</b>, lÃ m gá»‘c.</p>
<p>Gia pháº£ Ä‘iá»‡n tá»­ nÃ y Ä‘Æ°á»£c xÃ¢y dá»±ng trÃªn tinh tháº§n <b>tÃ´n trá»ng lá»‹ch sá»­ â€“ giá»¯ gÃ¬n truyá»n thá»‘ng â€“ truyá»n láº¡i cho mai sau</b>.</p>
<p style="text-align:right;font-weight:bold">Ban Gia pháº£ dÃ²ng há» LÃª ÄÃ¬nh</p>
</div>

<!-- ================= QUáº¢N LÃ ================= -->
<div id="manage" class="section">
<div id="manageBox" class="locked">

<b>ThÃªm / chá»‰nh sá»­a thÃ nh viÃªn</b><br><br>

<label>Thá»§y Tá»•:</label>
<input value="LÃª ÄÃ¬nh Cai" disabled><br>

<label>Cha:</label>
<select id="parentSelect"></select><br>

<label>Há» tÃªn:</label>
<input id="nameInput"><br>

<label>Con thá»© máº¥y:</label>
<input id="orderInput" type="number"><br>

<label>NÄƒm sinh:</label>
<input id="birthInput"><br>

<label>QuÃª quÃ¡n:</label>
<input id="homeInput"><br>

<label>NgÃ y giá»—:</label>
<input id="deathInput"><br><br>

<button onclick="addChild()">â• ThÃªm con</button>
<button onclick="updateNode()">âœï¸ Cáº­p nháº­t</button>
</div>

<p id="lockNote" style="color:#900;font-weight:bold">
ğŸ”’ Chá»‰ Admin má»›i Ä‘Æ°á»£c phÃ©p chá»‰nh sá»­a
</p>
</div>

<!-- ================= CÃ‚Y ================= -->
<div id="tree" class="section">
<div class="wrapper"><svg></svg></div>
</div>
</div>

<script>
/* ===== NAV ===== */
function show(id){
 document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
 document.getElementById(id).classList.add('active');
}

/* ===== ADMIN ===== */
const ADMIN_PASSWORD="ledinh123";
function isAdmin(){ return localStorage.getItem("ledinh_admin")==="1"; }

function adminLogin(){
 let p=prompt("Nháº­p máº­t kháº©u Admin:");
 if(p===ADMIN_PASSWORD){
   localStorage.setItem("ledinh_admin","1");
   location.reload();
 } else alert("Sai máº­t kháº©u");
}

if(isAdmin()){
 document.getElementById("manageBox").classList.remove("locked");
 document.getElementById("lockNote").style.display="none";
}

/* ===== DATA ===== */
let data=JSON.parse(localStorage.getItem("ledinh_data")) || {
 id:1,
 name:"Thá»§y Tá»• â€“ LÃª ÄÃ¬nh Cai",
 doi:1,
 gio:"Giá»— Tá»•: 17 thÃ¡ng GiÃªng",
 children:[]
};
let selectedId=null;
function save(){ localStorage.setItem("ledinh_data",JSON.stringify(data)); }

/* ===== UTIL ===== */
function all(n,a=[]){ a.push(n); (n.children||[]).forEach(c=>all(c,a)); return a; }

/* ===== SELECT ===== */
function refresh(){
 parentSelect.innerHTML="";
 all(data).forEach(n=>{
  parentSelect.add(new Option(n.name+" (Äá»i "+n.doi+")",n.id));
 });
}

/* ===== ADD ===== */
function addChild(){
 if(!isAdmin()) return alert("Chá»‰ Admin Ä‘Æ°á»£c thÃªm");
 let p=all(data).find(n=>n.id==parentSelect.value);
 if(!nameInput.value) return alert("Nháº­p há» tÃªn");
 p.children.push({
  id:Date.now(),
  name:nameInput.value,
  doi:p.doi+1,
  order:orderInput.value,
  birth:birthInput.value,
  home:homeInput.value,
  gio:deathInput.value,
  children:[]
 });
 clear(); save(); refresh(); draw();
}

/* ===== UPDATE ===== */
function updateNode(){
 if(!isAdmin()) return alert("Chá»‰ Admin Ä‘Æ°á»£c sá»­a");
 if(!selectedId||selectedId===1) return alert("KhÃ´ng sá»­a Thá»§y Tá»•");
 let p=all(data).find(n=>n.id===selectedId);
 Object.assign(p,{
  name:nameInput.value,
  order:orderInput.value,
  birth:birthInput.value,
  home:homeInput.value,
  gio:deathInput.value
 });
 save(); draw();
}

/* ===== FORM ===== */
function clear(){
 nameInput.value=orderInput.value=birthInput.value=homeInput.value=deathInput.value="";
}

/* ===== DRAW â€“ HIá»‚N THá»Š NÄ‚M SINH + QUÃŠ QUÃN ===== */
function draw(){
 d3.select("svg").selectAll("*").remove();
 let g=d3.select("svg").append("g").attr("transform","translate(200,400)");
 let root=d3.hierarchy(data);
 d3.tree().nodeSize([150,260])(root);

 g.selectAll(".link")
  .data(root.links()).enter().append("path")
  .attr("class","link")
  .attr("d",d3.linkHorizontal().x(d=>d.y).y(d=>d.x));

 let node=g.selectAll(".node")
  .data(root.descendants()).enter().append("g")
  .attr("class","node")
  .attr("transform",d=>`translate(${d.y},${d.x})`)
  .on("click",(e,d)=>{
    if(!isAdmin()||d.data.id===1) return;
    selectedId=d.data.id;
    nameInput.value=d.data.name;
    orderInput.value=d.data.order||"";
    birthInput.value=d.data.birth||"";
    homeInput.value=d.data.home||"";
    deathInput.value=d.data.gio||"";
  });

 node.append("rect")
  .attr("x",-120).attr("y",-60)
  .attr("width",240).attr("height",140);

 node.append("text")
  .attr("y",-38).attr("text-anchor","middle")
  .style("font-weight","bold")
  .text(d=>d.data.name);

 node.append("text")
  .attr("y",-18).attr("text-anchor","middle")
  .text(d=>d.data.id===1?"Thá»§y Tá»•":"Äá»i "+d.data.doi+" â€“ Con "+d.data.order);

 node.append("text")
  .attr("y",0).attr("text-anchor","middle")
  .style("font-size","12px")
  .text(d=>d.data.birth ? "NÄƒm sinh: "+d.data.birth : "");

 node.append("text")
  .attr("y",18).attr("text-anchor","middle")
  .style("font-size","12px")
  .text(d=>d.data.home ? "QuÃª quÃ¡n: "+d.data.home : "");

 node.append("text")
  .attr("y",36).attr("text-anchor","middle")
  .style("font-size","12px")
  .text(d=>d.data.gio||"");
}

refresh(); draw();
</script>
</body>
</html>
