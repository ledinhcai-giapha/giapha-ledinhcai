<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Gia pháº£ dÃ²ng há» LÃª ÄÃ¬nh</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://d3js.org/d3.v7.min.js"></script>

<style>
body{font-family:"Times New Roman",serif;margin:0;padding:10px}
h1{text-align:center}
button{margin:3px;padding:4px 8px}
.hidden{display:none}
#nav{text-align:center;margin-bottom:10px}
#nav button{font-weight:bold}

#intro{max-width:900px;margin:auto;font-size:18px;line-height:1.6}

#form{border:1px solid #ccc;padding:10px;background:#f9f9f9;margin-bottom:10px}
label{display:inline-block;width:90px}

.wrapper{width:100%;height:75vh;overflow:auto;border:1px solid #ccc}
svg{width:3000px;height:2000px}

.link{fill:none;stroke:#999;stroke-width:1.2px}
.node rect{fill:#fff;stroke:#333;rx:6;ry:6}
.name{font-weight:bold;text-anchor:middle}
.doi{text-anchor:middle;font-size:11px}
.thu{text-anchor:middle;font-size:11px;font-style:italic}
</style>
</head>

<body>

<h1>GIA PHáº¢ DÃ’NG Há»Œ LÃŠ ÄÃŒNH</h1>

<div id="nav">
  <button onclick="showPage('home')">ğŸ  Trang chá»§</button>
  <button onclick="showPage('manage')">âœï¸ Quáº£n lÃ½ gia pháº£</button>
</div>

<!-- ===== TRANG CHá»¦ ===== -->
<div id="home">
  <div id="intro">
    <h2>Lá»œI GIá»šI THIá»†U</h2>
    <p>
Gia pháº£ lÃ  sá»£i dÃ¢y ná»‘i liá»n cÃ¡c tháº¿ há»‡, lÃ  nÆ¡i lÆ°u giá»¯ cá»™i nguá»“n, cÃ´ng Ä‘á»©c tá»• tiÃªn
vÃ  truyá»n thá»‘ng cá»§a dÃ²ng há» qua bao Ä‘á»i.
    </p>
    <p>
DÃ²ng há» LÃª chÃºng ta láº¥y Thá»§y tá»• lÃ  <b>Cá»¥ LÃª ÄÃ¬nh Cai</b>, con trai cá»§a HoÃ ng thÃ¢n
<b>LÃª Duy Máº­t</b>, lÃ m gá»‘c. Tá»« Thá»§y tá»•, cÃ¡c Ä‘á»i con chÃ¡u tiáº¿p ná»‘i sinh sÃ´i, láº­p nghiá»‡p,
Ä‘Ã³ng gÃ³p cho gia Ä‘Ã¬nh, quÃª hÆ°Æ¡ng vÃ  Ä‘áº¥t nÆ°á»›c.
    </p>
    <p>
Viá»‡c xÃ¢y dá»±ng Gia pháº£ Ä‘iá»‡n tá»­ nháº±m:
<ul>
<li>GÃ¬n giá»¯ Ä‘áº§y Ä‘á»§, chÃ­nh xÃ¡c thÃ´ng tin cÃ¡c tháº¿ há»‡</li>
<li>GiÃºp con chÃ¡u tra cá»©u cá»™i nguá»“n, vai váº¿, thá»© báº­c</li>
<li>Thuáº­n tiá»‡n trong viá»‡c giá»— tá»•, giá»— chi</li>
<li>Káº¿t ná»‘i con chÃ¡u trong vÃ  ngoÃ i nÆ°á»›c</li>
</ul>
    </p>
    <p>
Gia pháº£ Ä‘iá»‡n tá»­ nÃ y Ä‘Æ°á»£c xÃ¢y dá»±ng trÃªn tinh tháº§n tÃ´n trá»ng lá»‹ch sá»­ â€“ giá»¯ gÃ¬n truyá»n thá»‘ng â€“
truyá»n láº¡i cho mai sau.
    </p>
    <p><i>
ğŸ“Œ Gia pháº£ nÃ y lÃ  tÃ i sáº£n chung cá»§a toÃ n thá»ƒ dÃ²ng há».
    </i></p>
  </div>
</div>

<!-- ===== QUáº¢N LÃ ===== -->
<div id="manage" class="hidden">

<div id="form">
<label>Chá»n ngÆ°á»i:</label>
<select id="editSelect"></select><br>

<label>Cha:</label>
<select id="parentSelect"></select><br>

<label>TÃªn:</label>
<input id="nameInput"><br>

<label>Thá»© tá»±:</label>
<input id="thuInput" type="number" min="1"><br>

<button onclick="addPerson()">â• ThÃªm</button>
<button onclick="updatePerson()">âœï¸ Cáº­p nháº­t</button>
</div>

<div class="wrapper">
  <svg></svg>
</div>
</div>

<script>
/* ===== LÆ¯U / LOAD ===== */
let data = JSON.parse(localStorage.getItem("giapha")) || {
  id:1,name:"LÃª ÄÃ¬nh Cai",doi:1,thu:1,children:[]
};
let idCounter = Date.now();

function save(){localStorage.setItem("giapha",JSON.stringify(data))}

/* ===== TIá»†N ÃCH ===== */
function allNodes(n,a=[]){a.push(n);(n.children||[]).forEach(c=>allNodes(c,a));return a}

/* ===== FORM ===== */
function refreshSelect(){
  parentSelect.innerHTML=editSelect.innerHTML="";
  allNodes(data).forEach(n=>{
    let t=`${n.name} (Äá»i ${n.doi})`;
    parentSelect.add(new Option(t,n.id));
    editSelect.add(new Option(t,n.id));
  })
}

editSelect.onchange=()=>{
  let n=allNodes(data).find(x=>x.id==editSelect.value);
  if(!n)return;
  nameInput.value=n.name;
  thuInput.value=n.thu;
}

/* ===== THÃŠM ===== */
function addPerson(){
  let p=allNodes(data).find(n=>n.id==parentSelect.value);
  if(!p)return;
  p.children.push({
    id:idCounter++,
    name:nameInput.value,
    doi:p.doi+1,
    thu:thuInput.value||1,
    children:[]
  });
  save();draw();refreshSelect();
}

/* ===== Sá»¬A ===== */
function updatePerson(){
  let n=allNodes(data).find(x=>x.id==editSelect.value);
  if(!n)return;
  n.name=nameInput.value;
  n.thu=thuInput.value;
  save();draw();refreshSelect();
}

/* ===== Váº¼ ===== */
function draw(){
  d3.select("svg").selectAll("*").remove();
  let g=d3.select("svg").append("g").attr("transform","translate(150,500)");
  let root=d3.hierarchy(data);
  d3.tree().nodeSize([90,220])(root);

  g.selectAll(".link").data(root.links()).enter().append("path")
   .attr("class","link")
   .attr("d",d3.linkHorizontal().x(d=>d.y).y(d=>d.x));

  let n=g.selectAll(".node").data(root.descendants()).enter()
   .append("g").attr("class","node")
   .attr("transform",d=>`translate(${d.y},${d.x})`);

  n.append("rect").attr("x",-70).attr("y",-32).attr("width",140).attr("height",64);
  n.append("text").attr("class","name").attr("y",-8).text(d=>d.data.name);
  n.append("text").attr("class","doi").attr("y",10).text(d=>"Äá»i "+d.data.doi);
  n.append("text").attr("class","thu").attr("y",26).text(d=>"Con thá»© "+d.data.thu);
}

/* ===== CHUYá»‚N TRANG ===== */
function showPage(p){
  home.classList.toggle("hidden",p!=="home");
  manage.classList.toggle("hidden",p!=="manage");
}

/* ===== INIT ===== */
refreshSelect();draw();
</script>
</body>
</html>
