<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Gia pháº£ dÃ²ng há» LÃª ÄÃ¬nh</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://d3js.org/d3.v7.min.js"></script>

<style>
body {
  font-family: "Times New Roman", serif;
  margin: 0;
  padding: 0;
}

header {
  text-align: center;
  padding: 15px;
  border-bottom: 1px solid #ccc;
}

nav {
  text-align: center;
  padding: 10px;
  background: #f3f3f3;
}

nav button {
  margin: 0 5px;
  padding: 6px 12px;
}

section {
  display: none;
  padding: 15px;
}

section.active {
  display: block;
}

#intro {
  max-width: 900px;
  margin: auto;
  line-height: 1.6;
}

#form {
  border: 1px solid #ccc;
  padding: 10px;
  background: #f9f9f9;
  margin-bottom: 10px;
}

label {
  display: inline-block;
  width: 100px;
}

input, select, button {
  margin: 5px 0;
}

.wrapper {
  width: 100%;
  height: 75vh;
  overflow: auto;
  border: 1px solid #ccc;
}

svg {
  width: 3000px;
  height: 2000px;
}

.link {
  fill: none;
  stroke: #999;
  stroke-width: 1.2px;
}

.node rect {
  fill: #fff;
  stroke: #333;
  stroke-width: 1.2px;
  rx: 6;
  ry: 6;
}

.node.selected rect {
  stroke: #d00;
  stroke-width: 2px;
}

.name {
  font-size: 13px;
  font-weight: bold;
  text-anchor: middle;
}

.doi {
  font-size: 11px;
  fill: #555;
  text-anchor: middle;
}
</style>
</head>

<body>

<header>
  <h1>GIA PHáº¢ DÃ’NG Há»Œ LÃŠ ÄÃŒNH</h1>
</header>

<nav>
  <button onclick="showSection('intro')">ğŸ  Trang chá»§</button>
  <button onclick="showSection('manage')">âœï¸ Quáº£n lÃ½ gia pháº£</button>
</nav>

<!-- ========== TRANG CHá»¦ ========== -->
<section id="intro" class="active">
  <h2>Lá»i giá»›i thiá»‡u</h2>
  <p>
    Gia pháº£ dÃ²ng há» LÃª ÄÃ¬nh Ä‘Æ°á»£c láº­p nháº±m ghi chÃ©p, lÆ°u giá»¯ vÃ  káº¿ thá»«a thÃ´ng tin
    vá» cÃ¡c tháº¿ há»‡ trong dÃ²ng há», báº¯t Ä‘áº§u tá»« Thá»§y tá»• <b>LÃª ÄÃ¬nh Cai</b>.
  </p>
  <p>
    Gia pháº£ hiá»‡n Ä‘ang Ä‘Æ°á»£c cáº­p nháº­t dáº§n theo tá»«ng Ä‘á»i. Viá»‡c biÃªn soáº¡n nháº±m giÃºp
    con chÃ¡u Ä‘á»i sau hiá»ƒu rÃµ cá»™i nguá»“n, thá»© báº­c, quan há»‡ huyáº¿t thá»‘ng vÃ  truyá»n
    thá»‘ng cá»§a dÃ²ng há».
  </p>
  <p>
    Gia pháº£ nÃ y mang tÃ­nh má»Ÿ, cÃ³ thá»ƒ tiáº¿p tá»¥c bá»• sung cÃ¡c tháº¿ há»‡ tiáº¿p theo trong
    tÆ°Æ¡ng lai.
  </p>
  <p>
    <i>NgÆ°á»i biÃªn soáº¡n & cáº­p nháº­t: DÃ²ng há» LÃª ÄÃ¬nh</i>
  </p>
</section>

<!-- ========== QUáº¢N LÃ GIA PHáº¢ ========== -->
<section id="manage">
  <div id="form">
    <label>Cha:</label>
    <select id="parentSelect"></select><br>

    <label>TÃªn:</label>
    <input id="nameInput" placeholder="VÃ­ dá»¥: LÃª ÄÃ¬nh Huy"><br>

    <label>Thá»© tá»±:</label>
    <input id="thuTuInput" type="number" min="1" placeholder="1 = con trÆ°á»Ÿng"><br>

    <button onclick="addPerson()">â• ThÃªm</button>
    <button onclick="updatePerson()">âœï¸ Cáº­p nháº­t</button>
  </div>

  <div class="wrapper">
    <svg></svg>
  </div>
</section>

<script>
/* ===== CHUYá»‚N TAB ===== */
function showSection(id) {
  document.querySelectorAll("section").forEach(s => s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

/* ===== Dá»® LIá»†U ===== */
let data = JSON.parse(localStorage.getItem("giapha")) || {
  id: 1,
  name: "LÃª ÄÃ¬nh Cai",
  doi: 1,
  thuTu: null,
  children: []
};

let idCounter = Date.now();
let selectedNode = null;

/* ===== TIá»†N ÃCH ===== */
function getAllNodes(node, arr = []) {
  arr.push(node);
  if (node.children) node.children.forEach(c => getAllNodes(c, arr));
  return arr;
}

/* ===== FORM ===== */
function refreshSelect() {
  parentSelect.innerHTML = "";
  getAllNodes(data).forEach(n => {
    const opt = document.createElement("option");
    opt.value = n.id;
    opt.text = `${n.name} (Äá»i ${n.doi})`;
    parentSelect.appendChild(opt);
  });
}

/* ===== THÃŠM ===== */
function addPerson() {
  const parent = getAllNodes(data).find(n => n.id == parentSelect.value);
  const name = nameInput.value.trim();
  const thuTu = thuTuInput.value ? Number(thuTuInput.value) : null;

  if (!name) return alert("ChÆ°a nháº­p tÃªn!");

  parent.children.push({
    id: idCounter++,
    name,
    doi: parent.doi + 1,
    thuTu,
    children: []
  });

  save();
}

/* ===== Cáº¬P NHáº¬T ===== */
function updatePerson() {
  if (!selectedNode) return alert("ChÆ°a chá»n ngÆ°á»i!");
  selectedNode.data.name = nameInput.value.trim();
  selectedNode.data.thuTu = thuTuInput.value ? Number(thuTuInput.value) : null;
  save();
}

/* ===== LÆ¯U ===== */
function save() {
  localStorage.setItem("giapha", JSON.stringify(data));
  refreshSelect();
  draw();
}

/* ===== Váº¼ ===== */
function draw() {
  d3.select("svg").selectAll("*").remove();

  const svg = d3.select("svg").append("g").attr("transform","translate(150,500)");
  const root = d3.hierarchy(data);
  d3.tree().nodeSize([80,220])(root);

  svg.selectAll(".link")
    .data(root.links())
    .enter().append("path")
    .attr("class","link")
    .attr("d", d3.linkHorizontal().x(d=>d.y).y(d=>d.x));

  const node = svg.selectAll(".node")
    .data(root.descendants())
    .enter().append("g")
    .attr("class", d => d===selectedNode?"node selected":"node")
    .attr("transform", d=>`translate(${d.y},${d.x})`)
    .on("click",(e,d)=>{
      selectedNode=d;
      nameInput.value=d.data.name;
      thuTuInput.value=d.data.thuTu||"";
      draw();
    });

  node.append("rect").attr("x",-70).attr("y",-28).attr("width",140).attr("height",56);
  node.append("text").attr("class","name").attr("y",-6).text(d=>d.data.name);
  node.append("text").attr("class","doi").attr("y",14)
    .text(d=> d.data.thuTu ? `Con thá»© ${d.data.thuTu} â€“ Äá»i ${d.data.doi}` : `Äá»i ${d.data.doi}`);
}

/* ===== KHá»I Táº O ===== */
refreshSelect();
draw();
</script>

</body>
</html>
