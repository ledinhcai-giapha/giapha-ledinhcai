<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Gia pháº£ dÃ²ng há» LÃª ÄÃ¬nh</title>
<script src="https://d3js.org/d3.v7.min.js"></script>

<style>
body{font-family:"Times New Roman",serif;margin:0;padding:10px}
h1{text-align:center}
nav{text-align:center;margin-bottom:10px}
nav button{margin:0 5px}

#intro,#manager{display:none}
#form{border:1px solid #ccc;padding:10px;background:#f9f9f9}

label{display:inline-block;width:90px}
input,select{margin:5px}

.wrapper{width:100%;height:75vh;overflow:auto;border:1px solid #ccc}
svg{width:3000px;height:2000px}

.link{fill:none;stroke:#999}
.node rect{fill:#fff;stroke:#333;rx:6;ry:6}
.name{text-anchor:middle;font-weight:bold}
.doi{text-anchor:middle;font-size:11px;fill:#555}
.thutu{text-anchor:middle;font-size:11px;font-style:italic}
</style>
</head>

<body>

<h1>GIA PHáº¢ DÃ’NG Há»Œ LÃŠ ÄÃŒNH</h1>

<nav>
  <button onclick="showIntro()">ğŸ  Trang chá»§</button>
  <button onclick="showManager()">âœï¸ Quáº£n lÃ½ gia pháº£</button>
</nav>

<!-- ===== TRANG CHá»¦ ===== -->
<div id="intro">
  <h2>Lá»i giá»›i thiá»‡u</h2>
  <p>
    Gia pháº£ dÃ²ng há» LÃª ÄÃ¬nh Ä‘Æ°á»£c láº­p nháº±m ghi nhá»› tá»• tiÃªn,
    gÃ¬n giá»¯ truyá»n thá»‘ng vÃ  káº¿t ná»‘i cÃ¡c tháº¿ há»‡ con chÃ¡u.
  </p>
</div>

<!-- ===== QUáº¢N LÃ ===== -->
<div id="manager">

<div id="form">
  <label>Chá»n ngÆ°á»i:</label>
  <select id="editSelect"></select><br>

  <label>Cha:</label>
  <select id="parentSelect"></select><br>

  <label>TÃªn:</label>
  <input id="nameInput"><br>

  <label>Thá»© tá»±:</label>
  <input id="orderInput" type="number" min="1"><br>

  <button onclick="addPerson()">â• ThÃªm</button>
  <button onclick="updatePerson()">âœï¸ Cáº­p nháº­t</button>
</div>

<div class="wrapper">
  <svg></svg>
</div>
</div>

<script>
/* ===== Dá»® LIá»†U ===== */
let data = JSON.parse(localStorage.getItem("giapha")) || {
  id:1,name:"LÃª ÄÃ¬nh Cai",doi:1,order:1,children:[]
};
let idCounter = Date.now();

/* ===== TIá»†N ÃCH ===== */
function all(node,arr=[]){
  arr.push(node);
  node.children?.forEach(c=>all(c,arr));
  return arr;
}

/* ===== FORM ===== */
function refreshForm(){
  parentSelect.innerHTML=editSelect.innerHTML="";
  all(data).forEach(n=>{
    parentSelect.add(new Option(`${n.name} (Äá»i ${n.doi})`,n.id));
    editSelect.add(new Option(`${n.name}`,n.id));
  });
}

/* ===== THÃŠM ===== */
function addPerson(){
  const p=all(data).find(n=>n.id==parentSelect.value);
  p.children.push({
    id:idCounter++,name:nameInput.value,
    doi:p.doi+1,order:+orderInput.value,children:[]
  });
  save();
}

/* ===== Sá»¬A ===== */
function updatePerson(){
  const n=all(data).find(x=>x.id==editSelect.value);
  n.name=nameInput.value;
  n.order=+orderInput.value;
  save();
}

/* ===== Váº¼ ===== */
function draw(){
  d3.select("svg").selectAll("*").remove();
  const g=d3.select("svg").append("g").attr("transform","translate(150,500)");
  const root=d3.hierarchy(data);
  d3.tree().nodeSize([90,220])(root);

  g.selectAll(".link").data(root.links()).enter().append("path")
    .attr("class","link")
    .attr("d",d3.linkHorizontal().x(d=>d.y).y(d=>d.x));

  const node=g.selectAll(".node").data(root.descendants()).enter()
    .append("g").attr("class","node")
    .attr("transform",d=>`translate(${d.y},${d.x})`);

  node.append("rect").attr("x",-70).attr("y",-35).attr("width",140).attr("height",70);
  node.append("text").attr("class","name").attr("y",-10).text(d=>d.data.name);
  node.append("text").attr("class","doi").attr("y",10).text(d=>"Äá»i "+d.data.doi);
  node.append("text").attr("class","thutu").attr("y",25)
      .text(d=>"Con thá»© "+d.data.order);
}

function save(){
  localStorage.setItem("giapha",JSON.stringify(data));
  refreshForm(); draw();
}

/* ===== ÄIá»€U HÆ¯á»šNG ===== */
function showIntro(){intro.style.display="block";manager.style.display="none"}
function showManager(){intro.style.display="none";manager.style.display="block"}

refreshForm(); draw(); showIntro();
</script>

</body>
</html>
